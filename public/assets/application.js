(function(){var a;a=null;window.enableSubmitButton=function(){var b;b=$("#payment-form").find("a.submit-button");return b.attr("disabled",false).removeAttr("disabled")};window.IndexCtrl=function(b,d){var c;b.legislators=[];c=$("#credit-card-modal").modal("hide");$(function(){setTimeout(function(){return $(".mass-hide.hidden").hide().removeClass("hidden").fadeIn()},500);return $("textarea").bind("keypress",function(f){if((f.keyCode||f.which)===13){return false}})});b.searchByZip=function(){clearTimeout(a);return a=setTimeout(function(){return b.getLegislators()},800)};b.showPaymentForm=function(){var e;$(".errors").html("");e=[];if(!b.postcard){e.push("You haven't filled out any fields.")}if(b.postcard&&!b.postcard.message){e.push("A message is required.")}if(b.postcard&&!b.postcard.street1){e.push("Representative is required. <small>Enter your zip in step #1 and then click on a representative's photo.</small>")}if(e.length<=0){return c.modal("show")}else{return $(".errors").html(e.join(" "))}};b.showSenderAddress=function(){return $(".sender_address").removeClass("hidden")};b.showSenderStreet2=function(){if(!!b.postcard.sender_street2){return $(".sender_street2").removeClass("hidden")}else{return $(".sender_street2").addClass("hidden")}};b.chargeAndDeliver=function(){var e;e=$("#payment-form").find("a.submit-button");e.attr("disabled",true);$(".payment-errors").html("");return Stripe.createToken({number:$(".card-number").val(),cvc:$(".card-cvc").val(),exp_month:$(".card-expiry-month").val(),exp_year:$(".card-expiry-year").val()},b.stripeResponseHandler)};b.getLegislators=function(){return d.get("/api/v0/legislators.json?postalcode="+b.postcard.sender_postalcode).success(function(e){if(!!a){b.legislators=e.legislators;if(b.legislators.length>0){$(".zip-no-results").hide();$(".reps-list .help-text").show()}else{$(".reps-list .help-text").hide();if(b.postcard.sender_postalcode.length>=5){$(".zip-no-results").show()}}return setTimeout(function(){return $("a[rel='popover']").tooltip({trigger:"hover",placement:"top"})},500)}})};b.setLegislator=function(f){var j,h,e,g;g=b.legislators;for(h=0,e=g.length;h<e;h++){j=g[h];j["class"]=null}return b.postcard={"class":b.legislators[f]["class"]="active",name:b.legislators[f].name,street1:b.legislators[f].street1,street2:b.legislators[f].street2,city:b.legislators[f].city,state:b.legislators[f].state,postalcode:b.legislators[f].postalcode,greeting:b.legislators[f].greeting,sender_name:!!b.postcard?b.postcard.sender_name:void 0,sender_street1:!!b.postcard?b.postcard.sender_street1:void 0,sender_street2:!!b.postcard?b.postcard.sender_street2:void 0,sender_city:!!b.postcard?b.postcard.sender_city:void 0,sender_state:!!b.postcard?b.postcard.sender_state:void 0,sender_postalcode:!!b.postcard?b.postcard.sender_postalcode:void 0}};return b.stripeResponseHandler=function(e,g){var f,j,i,h;if(g.error){$(".payment-errors").text(g.error.message);return enableSubmitButton()}else{f=$("#payment-form");i=g.id;f.append("<input type='hidden' name='stripeToken' value='"+i+"'/>");h="/api/v0/postcards.json";j={};b.$apply(function(){return j={card:i,message:""+b.postcard.greeting+"\n\n"+b.postcard.message,name:b.postcard.name,street1:b.postcard.street1,street2:b.postcard.street2,city:b.postcard.city,state:b.postcard.state,postalcode:b.postcard.postalcode,sender_name:b.postcard.sender_name,sender_street1:b.postcard.sender_street1,sender_street2:b.postcard.sender_street2,sender_city:b.postcard.sender_city,sender_state:b.postcard.sender_state,sender_postalcode:b.postcard.sender_postalcode}});return $.ajax({type:"POST",url:h,data:j,success:function(l){var m,k;enableSubmitButton();k=JSON.parse(l);if(!!k.success){c=$("#credit-card-modal").modal("hide");return m=$("#thank-you-modal").modal("show")}else{return $(".payment-errors").text(k.error.message)}},error:function(){enableSubmitButton();return alert("There was an error. Refresh the page and try again.")}})}}};IndexCtrl.$inject=["$scope","$http"];window.CreditCard=(function(){function b(){this.preloadCardIcons();this.showCCProvider()}b.prototype.showCCProvider=function(){var e,d,c,f=this;e=$(".card-number");d=0;c=!1;return e.keyup(function(){var j,k,i,h,g;j=e.val();if(!j){return f._showCard()}k=j.charAt(0);h=j.charAt(1);g=j.charAt(2);i=j.charAt(3);if(f._isVisa(k)){return f._showCard("visa")}else{if(f._isMastercard(k,h)){return f._showCard("mastercard")}else{if(f._isAmex(k,h)){return f._showCard("amex")}else{if(f._isDiscover(k,h,g,i)){return f._showCard("discover")}else{return f._showCard()}}}}})};b.prototype.preloadCardIcons=function(){var f,g,e,d,c;f=["/images/cc/generic.png","/images/cc/visa.png","/images/cc/mastercard.png","/images/cc/amex.png","/images/cc/discover.png"];c=[];for(e=0,d=f.length;e<d;e++){g=f[e];c.push($("<img/>")[0].src=g)}return c};b.prototype._showCard=function(d){var c;c=$(".card-icon");c.css({opacity:1});switch(d){case"visa":return c.attr("src","/images/cc/visa.png");case"mastercard":return c.attr("src","/images/cc/mastercard.png");case"amex":return c.attr("src","/images/cc/amex.png");case"discover":return c.attr("src","/images/cc/discover.png");default:c.css({opacity:0.2});return c.attr("src","/images/cc/generic.png")}};b.prototype._isVisa=function(c){return parseInt(c)===4};b.prototype._isMastercard=function(d,c){d=parseInt(d);c=parseInt(c);return(d===5)&&(c===1)||(c===2)||(c===3)||(c===4)||(c===5)};b.prototype._isAmex=function(d,c){d=parseInt(d);c=parseInt(c);return(d===3)&&(c===4)||(c===7)};b.prototype._isDiscover=function(f,d,c,e){f=parseInt(f);d=parseInt(d);c=parseInt(c);e=parseInt(e);return(f===6)&&(d===0)&&(c===1)&&(e===1)};return b})()}).call(this);